<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Mobile Barcode Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>

    body {

      font-family: Arial, sans-serif;

      text-align: center;

      padding: 10px;

    }

    video {

      width: 100%;

      max-width: 420px;

      border: 2px solid #333;

      border-radius: 8px;

      margin-top: 10px;

    }

    button {

      font-size: 18px;

      padding: 10px 16px;

      margin-top: 12px;

      cursor: pointer;

    }

    #result {

      margin-top: 15px;

      font-size: 1.2em;

      font-weight: bold;

    }
</style>
</head>
<body>
<h2>ðŸ“¦ Barcode Scanner</h2>
<button id="startBtn">Start Scan</button>
<video id="video" autoplay playsinline></video>
<div id="result">Waitingâ€¦</div>
<script>

    const startBtn = document.getElementById("startBtn");

    const video = document.getElementById("video");

    const result = document.getElementById("result");

    let stream = null;

    let productTable = {};

    // -------- LOAD CSV --------

    async function loadProducts() {

      const response = await fetch("products.csv");

      const text = await response.text();

      const lines = text.split("\n").slice(1); // skip header

      lines.forEach(line => {

        const [barcode, description] = line.split(",");

        if (barcode && description) {

          productTable[barcode.trim()] = description.trim();

        }

      });

    }

    loadProducts();

    // -------- START SCAN (USER GESTURE REQUIRED) --------

    startBtn.addEventListener("click", async () => {

      if (!("BarcodeDetector" in window)) {

        result.textContent = "Barcode scanning not supported on this device.";

        return;

      }

      try {

        const detector = new BarcodeDetector({

          formats: ["ean_13", "ean_8", "upc_a", "upc_e", "code_128", "qr_code"]

        });

        stream = await navigator.mediaDevices.getUserMedia({

          video: { facingMode: "environment" }

        });

        video.srcObject = stream;

        result.textContent = "Scanningâ€¦";

        scanLoop(detector);

      } catch (err) {

        console.error(err);

        result.textContent = "Camera access denied.";

      }

    });

    // -------- SCAN LOOP --------

    async function scanLoop(detector) {

      try {

        const barcodes = await detector.detect(video);

        if (barcodes.length > 0) {

          const code = barcodes[0].rawValue;

          stopCamera();

          if (productTable[code]) {

            result.textContent = "âœ… " + productTable[code];

          } else {

            result.textContent = "âŒ Unknown product: " + code;

          }

          navigator.vibrate?.(200);

          return;

        }

      } catch (e) {

        console.error(e);

      }

      requestAnimationFrame(() => scanLoop(detector));

    }

    function stopCamera() {

      if (stream) {

        stream.getTracks().forEach(t => t.stop());

        stream = null;

      }

    }
</script>
</body>
</html>
 
